# ‚úÖ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê

## üéØ –í–∞—à–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üñº –£–Ω–∏–∫–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
–ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π (1-10)
üìÅ –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞" ‚Üí –∫–Ω–æ–ø–∫–∏: JPEG / PNG / WEBP
üîÑ –û—Ç—Ä–∞–∑–∏—Ç—å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏? ‚Üí –∫–Ω–æ–ø–∫–∏: –î–∞ / –ù–µ—Ç / –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
‚úçÔ∏è –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: "–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç?" ‚Üí –∫–Ω–æ–ø–∫–∏: –î–∞ / –ù–µ—Ç / –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
‚ûï –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: "–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ?" ‚Üí –∫–Ω–æ–ø–∫–∏: –î–∞ / –ù–µ—Ç / –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
   7.1. –ï—Å–ª–∏ –î–∞ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Ç–æ—Ä–æ–µ —Ñ–æ—Ç–æ
   7.2. –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é (–í–µ—Ä—Ö-–ª–µ–≤–æ/–í–µ—Ä—Ö-–ø—Ä–∞–≤–æ/–ù–∏–∑-–ª–µ–≤–æ/–ù–∏–∑-–ø—Ä–∞–≤–æ/–¶–µ–Ω—Ç—Ä)
   7.3. –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0-100)
8. –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –∫–æ–ø–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç
```

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ - –í–°–Å!

### 1. –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (bot/keyboards/main_keyboards.py)

‚úÖ **get_file_format_keyboard()** - —Å—Ç—Ä–æ–∫–∏ 114-124
```python
[JPEG] [PNG] [WEBP]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é]
```

‚úÖ **get_yes_no_keyboard()** - —Å—Ç—Ä–æ–∫–∏ 127-136
```python
[‚úÖ –î–∞] [‚ùå –ù–µ—Ç]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é]
```

‚úÖ **get_overlay_position_keyboard()** - —Å—Ç—Ä–æ–∫–∏ 139-155
```python
[‚ÜñÔ∏è –í–µ—Ä—Ö-–ª–µ–≤–æ] [‚ÜóÔ∏è –í–µ—Ä—Ö-–ø—Ä–∞–≤–æ]
[‚ÜôÔ∏è –ù–∏–∑-–ª–µ–≤–æ] [‚ÜòÔ∏è –ù–∏–∑-–ø—Ä–∞–≤–æ]
[üéØ –¶–µ–Ω—Ç—Ä]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é]
```

### 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (bot/handlers/uniquification.py)

‚úÖ **select_copies_count()** - —Å—Ç—Ä–æ–∫–∏ 91-112
- –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ context
- –ü–µ—Ä–µ—Ö–æ–¥ ‚Üí –≤—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞

‚úÖ **select_file_format()** - —Å—Ç—Ä–æ–∫–∏ 115-134
- –ü–æ–ª—É—á–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç (jpeg/png/webp)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ context
- –ü–µ—Ä–µ—Ö–æ–¥ ‚Üí –≤–æ–ø—Ä–æ—Å –æ–± –æ—Ç—Ä–∞–∂–µ–Ω–∏–∏

‚úÖ **select_flip_choice()** - —Å—Ç—Ä–æ–∫–∏ 137-156
- –ü–æ–ª—É—á–∞–µ—Ç –≤—ã–±–æ—Ä –î–∞/–ù–µ—Ç –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ context
- –ü–µ—Ä–µ—Ö–æ–¥ ‚Üí –≤–æ–ø—Ä–æ—Å –æ —Ç–µ–∫—Å—Ç–µ

‚úÖ **select_text_choice()** - —Å—Ç—Ä–æ–∫–∏ 159-183
- –ü–æ–ª—É—á–∞–µ—Ç –≤—ã–±–æ—Ä –î–∞/–ù–µ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞
- –ï—Å–ª–∏ –î–∞ ‚Üí –∂–¥–µ—Ç –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
- –ï—Å–ª–∏ –ù–µ—Ç ‚Üí –≤–æ–ø—Ä–æ—Å –æ –¥–æ–ø. —Ñ–æ—Ç–æ

‚úÖ **receive_text_input()** - —Å—Ç—Ä–æ–∫–∏ 186-202
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ context
- –ü–µ—Ä–µ—Ö–æ–¥ ‚Üí –≤–æ–ø—Ä–æ—Å –æ –¥–æ–ø. —Ñ–æ—Ç–æ

‚úÖ **select_overlay_choice()** - —Å—Ç—Ä–æ–∫–∏ 205-224
- –ü–æ–ª—É—á–∞–µ—Ç –≤—ã–±–æ—Ä –î–∞/–ù–µ—Ç –¥–ª—è –¥–æ–ø. —Ñ–æ—Ç–æ
- –ï—Å–ª–∏ –î–∞ ‚Üí –∂–¥–µ—Ç —Ñ–æ—Ç–æ
- –ï—Å–ª–∏ –ù–µ—Ç ‚Üí –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

‚úÖ **receive_overlay_photo()** - —Å—Ç—Ä–æ–∫–∏ 227-243
- –ü–æ–ª—É—á–∞–µ—Ç –≤—Ç–æ—Ä–æ–µ —Ñ–æ—Ç–æ
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç file_id –≤ context
- –ü–µ—Ä–µ—Ö–æ–¥ ‚Üí –≤—ã–±–æ—Ä –ø–æ–∑–∏—Ü–∏–∏

‚úÖ **select_overlay_position()** - —Å—Ç—Ä–æ–∫–∏ 246-267
- –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é (top_left, top_right, bottom_left, bottom_right, center)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ context
- –ü–µ—Ä–µ—Ö–æ–¥ ‚Üí –≤–≤–æ–¥ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏

‚úÖ **receive_overlay_opacity()** - —Å—Ç—Ä–æ–∫–∏ 270-309
- –ü–æ–ª—É—á–∞–µ—Ç —á–∏—Å–ª–æ 0-100
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞
- –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

‚úÖ **process_photo_uniquification()** - —Å—Ç—Ä–æ–∫–∏ 312-357 (–æ–±–Ω–æ–≤–ª–µ–Ω)
- –°–æ–±–∏—Ä–∞–µ—Ç –í–°–ï –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ context
- –°–∫–∞—á–∏–≤–∞–µ—Ç –æ–±–∞ —Ñ–æ—Ç–æ (–æ—Å–Ω–æ–≤–Ω–æ–µ + overlay)
- –ü–µ—Ä–µ–¥–∞–µ—Ç –≤ Celery –∑–∞–¥–∞—á—É

### 3. –°–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (bot/handlers/uniquification.py)

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 8 –Ω–æ–≤—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π - —Å—Ç—Ä–æ–∫–∏ 30-37:
```python
WAITING_FOR_FILE_FORMAT = 5
WAITING_FOR_FLIP_CHOICE = 6
WAITING_FOR_TEXT_CHOICE = 7
WAITING_FOR_TEXT_INPUT = 8
WAITING_FOR_OVERLAY_CHOICE = 9
WAITING_FOR_OVERLAY_PHOTO = 10
WAITING_FOR_OVERLAY_POSITION = 11
WAITING_FOR_OVERLAY_OPACITY = 12
```

### 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (main.py)

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω ConversationHandler - —Å—Ç—Ä–æ–∫–∏ 97-113:
```python
photo_unique_conv = ConversationHandler(
    entry_points=[CallbackQueryHandler(unique_photo_start, pattern="^menu_unique_photo$")],
    states={
        WAITING_FOR_PHOTO: [MessageHandler(filters.PHOTO, receive_photo)],
        WAITING_FOR_PHOTO_COPIES: [CallbackQueryHandler(select_copies_count, pattern="^copies_")],
        WAITING_FOR_FILE_FORMAT: [CallbackQueryHandler(select_file_format, pattern="^format_")],
        WAITING_FOR_FLIP_CHOICE: [CallbackQueryHandler(select_flip_choice, pattern="^answer_")],
        WAITING_FOR_TEXT_CHOICE: [CallbackQueryHandler(select_text_choice, pattern="^answer_")],
        WAITING_FOR_TEXT_INPUT: [MessageHandler(filters.TEXT & ~filters.COMMAND, receive_text_input)],
        WAITING_FOR_OVERLAY_CHOICE: [CallbackQueryHandler(select_overlay_choice, pattern="^answer_")],
        WAITING_FOR_OVERLAY_PHOTO: [MessageHandler(filters.PHOTO, receive_overlay_photo)],
        WAITING_FOR_OVERLAY_POSITION: [CallbackQueryHandler(select_overlay_position, pattern="^position_")],
        WAITING_FOR_OVERLAY_OPACITY: [MessageHandler(filters.TEXT & ~filters.COMMAND, receive_overlay_opacity)],
    },
    fallbacks=[CallbackQueryHandler(menu_callback, pattern="^back_to_menu$")]
)
```

### 5. Celery –∑–∞–¥–∞—á–∞ (workers/tasks/uniquification_tasks.py)

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ - —Å—Ç—Ä–æ–∫–∏ 16-29:
```python
def uniquify_photo_task(
    self,
    action_log_id: int,
    input_file_path: str,
    copies_count: int,
    preset_id: int,
    file_format: str = 'jpeg',           # –ù–û–í–û–ï
    flip_horizontal: bool = False,       # –ù–û–í–û–ï
    overlay_text: str = None,            # –ù–û–í–û–ï
    overlay_photo_path: str = None,      # –ù–û–í–û–ï
    overlay_position: str = None,        # –ù–û–í–û–ï
    overlay_opacity: int = None          # –ù–û–í–û–ï
)
```

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ - —Å—Ç—Ä–æ–∫–∏ 56-67:
```python
config = preset.config.copy()
config['file_format'] = file_format
config['flip_horizontal'] = flip_horizontal
if overlay_text:
    config['overlay_text'] = overlay_text
if overlay_photo_path:
    config['overlay_photo_path'] = overlay_photo_path
    config['overlay_position'] = overlay_position
    config['overlay_opacity'] = overlay_opacity
```

### 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ (workers/uniquification/photo_uniquifier.py)

‚úÖ **__init__** –æ–±–Ω–æ–≤–ª–µ–Ω - —Å—Ç—Ä–æ–∫–∏ 25-30:
```python
self.file_format = preset_config.get('file_format', 'jpeg')
self.flip_horizontal = preset_config.get('flip_horizontal', False)
self.overlay_text = preset_config.get('overlay_text')
self.overlay_photo_path = preset_config.get('overlay_photo_path')
self.overlay_position = preset_config.get('overlay_position', 'center')
self.overlay_opacity = preset_config.get('overlay_opacity', 100)
```

‚úÖ **uniquify** –æ–±–Ω–æ–≤–ª–µ–Ω - —Å—Ç—Ä–æ–∫–∏ 56-104:
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è (ImageOps.mirror)
- –ù–∞–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (_apply_text_overlay)
- –ù–∞–ª–æ–∂–µ–Ω–∏–µ —Ñ–æ—Ç–æ (_apply_photo_overlay)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

‚úÖ **_apply_text_overlay** - —Å—Ç—Ä–æ–∫–∏ 119-158:
- –ó–∞–≥—Ä—É–∑–∫–∞ —à—Ä–∏—Ñ—Ç–∞ (arial.ttf –∏–ª–∏ default)
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑—É –ø–æ —Ü–µ–Ω—Ç—Ä—É
- –¢–µ–Ω—å –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

‚úÖ **_apply_photo_overlay** - —Å—Ç—Ä–æ–∫–∏ 160-219:
- –ó–∞–≥—Ä—É–∑–∫–∞ overlay —Ñ–æ—Ç–æ
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ (30% –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 6
- **–ù–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 12
- **–ù–æ–≤—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:** 8
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~400

## üé¨ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–ü–†–û–°–¢–û –ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–ï –ë–û–¢–ê!**

```bash
# Windows
cd C:\Users\che_d\Desktop\—É–Ω–∏–∫\creo-bot
python main.py
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ—á–Ω–æ –ø–æ –≤–∞—à–µ–º—É –¢–ó!

## üìã –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [x] –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã
- [x] –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [x] ConversationHandler –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] Celery –∑–∞–¥–∞—á–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∞
- [x] –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [x] –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

## üöÄ –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£!
